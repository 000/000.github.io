<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>รายงานข้อเท็จจริง - โครงการ DSL Platform</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&family=Prompt:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-white: #FFFFFF;
            --primary-black: #1D1D1F;
            --accent-blue: #0071E3;
            --accent-blue-hover: #0077ED;
            --gray-50: #FAFAFA;
            --gray-100: #F5F5F7;
            --gray-200: #E8E8ED;
            --gray-300: #D2D2D7;
            --gray-500: #86868B;
            --gray-700: #6E6E73;
            --success-green: #34C759;
            --warning-orange: #FF9500;
            --danger-red: #FF3B30;
            --purple: #AF52DE;
            --teal: #5AC8FA;
            --process-teal: #4ECDC4;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
            --shadow-lg: 0 8px 32px rgba(0,0,0,0.16);
            --shadow-xl: 0 15px 50px rgba(0,0,0,0.2);
            --transition-fast: 0.2s cubic-bezier(0.25, 0.1, 0.25, 1);
            --transition-medium: 0.4s cubic-bezier(0.25, 0.1, 0.25, 1);
            --transition-slow: 0.6s cubic-bezier(0.25, 0.1, 0.25, 1);
            --font-main: 'Sarabun', -apple-system, BlinkMacSystemFont, sans-serif;
            --font-heading: 'Prompt', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-main);
            background: var(--gray-100);
            color: var(--primary-black);
            line-height: 1.7;
            overflow-x: hidden;
        }

        /* Navigation */
        .nav-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: saturate(180%) blur(20px);
            -webkit-backdrop-filter: saturate(180%) blur(20px);
            border-bottom: 1px solid var(--gray-200);
        }

        .nav-content {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 24px;
            height: 52px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .nav-logo {
            font-family: var(--font-heading);
            font-size: 18px;
            font-weight: 600;
            color: var(--primary-black);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-logo svg {
            width: 24px;
            height: 24px;
        }

        .nav-links {
            display: flex;
            gap: 32px;
            list-style: none;
        }

        .nav-links a {
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-700);
            text-decoration: none;
            transition: color var(--transition-fast);
            position: relative;
        }

        .nav-links a:hover {
            color: var(--primary-black);
        }

        .nav-links a.active {
            color: var(--accent-blue);
        }

        .nav-links a.active::after {
            content: '';
            position: absolute;
            bottom: -16px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--accent-blue);
            border-radius: 1px;
        }

        /* Hero Section */
        .hero {
            padding: 120px 24px 80px;
            text-align: center;
            background: linear-gradient(180deg, var(--primary-black) 0%, #2c2c2e 100%);
            color: var(--primary-white);
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--accent-blue);
            color: white;
            font-size: 12px;
            font-weight: 600;
            border-radius: 20px;
            margin-bottom: 24px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .hero h1 {
            font-family: var(--font-heading);
            font-size: clamp(32px, 5vw, 56px);
            font-weight: 700;
            line-height: 1.1;
            margin-bottom: 16px;
        }

        .hero-subtitle {
            font-size: 20px;
            opacity: 0.8;
            max-width: 720px;
            margin: 0 auto 32px;
            font-weight: 400;
        }

        .hero-meta {
            display: flex;
            justify-content: center;
            gap: 32px;
            flex-wrap: wrap;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            opacity: 0.7;
        }

        .meta-item svg {
            width: 16px;
            height: 16px;
        }

        /* Section Styles */
        .section {
            padding: 80px 24px;
            max-width: 1600px;
            margin: 0 auto;
        }

        .section-header {
            text-align: center;
            margin-bottom: 48px;
        }

        .section-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--accent-blue);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .section-title {
            font-family: var(--font-heading);
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 16px;
        }

        .section-description {
            font-size: 18px;
            color: var(--gray-700);
            max-width: 640px;
            margin: 0 auto;
        }

        /* Executive Summary */
        .executive-summary {
            background: var(--primary-white);
            border-radius: 24px;
            padding: 48px;
            margin-bottom: 48px;
            box-shadow: var(--shadow-md);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-top: 32px;
        }

        .summary-card {
            padding: 24px;
            border-radius: 16px;
            background: var(--gray-50);
            border-left: 4px solid;
            transition: all var(--transition-medium);
        }

        .summary-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }

        .summary-card.process {
            border-left-color: var(--process-teal);
        }

        .summary-card.conflict {
            border-left-color: var(--danger-red);
        }

        .summary-card.decision {
            border-left-color: var(--accent-blue);
        }

        .summary-card h3 {
            font-family: var(--font-heading);
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .summary-card.process h3 { color: var(--process-teal); }
        .summary-card.conflict h3 { color: var(--danger-red); }
        .summary-card.decision h3 { color: var(--accent-blue); }

        .summary-card p {
            font-size: 14px;
            color: var(--gray-700);
            line-height: 1.6;
        }

        /* Affirmation Quote */
        .affirmation {
            background: linear-gradient(135deg, #E8F4FD 0%, #F0F7FF 100%);
            padding: 32px;
            border-radius: 16px;
            border-left: 5px solid var(--accent-blue);
            margin-top: 32px;
            font-style: italic;
            color: var(--accent-blue);
            font-weight: 500;
            line-height: 1.8;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 48px;
        }

        .stat-card {
            background: var(--primary-white);
            border-radius: 20px;
            padding: 28px;
            text-align: center;
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-medium);
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
        }

        .stat-icon.blue { background: rgba(0, 113, 227, 0.1); color: var(--accent-blue); }
        .stat-icon.green { background: rgba(52, 199, 89, 0.1); color: var(--success-green); }
        .stat-icon.orange { background: rgba(255, 149, 0, 0.1); color: var(--warning-orange); }
        .stat-icon.red { background: rgba(255, 59, 48, 0.1); color: var(--danger-red); }
        .stat-icon.purple { background: rgba(175, 82, 222, 0.1); color: var(--purple); }

        .stat-value {
            font-family: var(--font-heading);
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 14px;
            color: var(--gray-500);
        }

        /* Visualization Controls */
        .viz-controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .viz-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            font-family: inherit;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .viz-btn.primary {
            background: var(--accent-blue);
            color: white;
        }

        .viz-btn.primary:hover {
            background: var(--accent-blue-hover);
            transform: scale(1.02);
        }

        .viz-btn.secondary {
            background: var(--gray-200);
            color: var(--primary-black);
        }

        .viz-btn.secondary:hover {
            background: var(--gray-300);
        }

        .viz-btn.active {
            background: var(--primary-black);
            color: white;
        }

        /* Filter Pills */
        .filter-container {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .filter-pill {
            padding: 8px 16px;
            border: 2px solid var(--gray-200);
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
            background: var(--primary-white);
            font-family: inherit;
        }

        .filter-pill:hover {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
        }

        .filter-pill.active {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
            color: white;
        }

        .filter-pill.conflict {
            border-color: var(--danger-red);
        }

        .filter-pill.conflict.active {
            background: var(--danger-red);
            border-color: var(--danger-red);
        }

        /* Visualization Container */
        .viz-container {
            background: var(--primary-white);
            border-radius: 24px;
            box-shadow: var(--shadow-md);
            overflow: hidden;
            position: relative;
        }

        .viz-header {
            padding: 24px 32px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
        }

        .viz-title {
            font-family: var(--font-heading);
            font-size: 18px;
            font-weight: 600;
        }

        .viz-legend {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: var(--gray-500);
        }

        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .legend-diamond {
            width: 10px;
            height: 10px;
            background: var(--danger-red);
            transform: rotate(45deg);
        }

        .viz-body {
            padding: 32px;
            min-height: 700px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .viz-body svg {
            width: 100%;
            height: 100%;
            overflow: visible;
        }

        /* Loading State */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 16px;
            padding: 60px;
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--gray-200);
            border-top-color: var(--accent-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Split Panel Layout */
        .split-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            align-items: start;
        }

        @media (max-width: 1024px) {
            .split-container {
                grid-template-columns: 1fr;
            }
        }

        .vertical-timeline-container {
            background: var(--primary-white);
            border-radius: 24px;
            padding: 32px;
            box-shadow: var(--shadow-md);
            max-height: 800px;
            overflow-y: auto;
        }

        .detail-panel-container {
            background: var(--primary-white);
            border-radius: 24px;
            padding: 32px;
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 80px;
        }

        .detail-panel-placeholder {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray-500);
        }

        .detail-panel-placeholder svg {
            width: 64px;
            height: 64px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        /* Vertical Timeline Styles */
        .vertical-timeline {
            position: relative;
            padding-left: 40px;
        }

        .vertical-timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(180deg, var(--success-green) 0%, var(--warning-orange) 50%, var(--danger-red) 100%);
            border-radius: 2px;
        }

        .timeline-event {
            position: relative;
            padding: 20px 0;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .timeline-event:hover {
            transform: translateX(8px);
        }

        .timeline-event.active .event-marker {
            transform: scale(1.3);
            box-shadow: 0 0 0 4px rgba(0, 113, 227, 0.2);
        }

        .event-marker {
            position: absolute;
            left: -40px;
            top: 24px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--primary-white);
            border: 3px solid;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 700;
            color: white;
            transition: all var(--transition-fast);
            z-index: 1;
        }

        .event-marker.meeting { border-color: var(--accent-blue); background: var(--accent-blue); }
        .event-marker.document { border-color: var(--success-green); background: var(--success-green); }
        .event-marker.decision { border-color: var(--warning-orange); background: var(--warning-orange); }
        .event-marker.conflict { 
            border-color: var(--danger-red); 
            background: var(--danger-red);
            border-radius: 4px;
            transform: rotate(45deg);
        }
        .event-marker.conflict span {
            transform: rotate(-45deg);
        }

        .event-content {
            background: var(--gray-50);
            border-radius: 12px;
            padding: 16px 20px;
            border-left: 4px solid transparent;
            transition: all var(--transition-fast);
        }

        .timeline-event:hover .event-content,
        .timeline-event.active .event-content {
            background: var(--primary-white);
            box-shadow: var(--shadow-sm);
        }

        .timeline-event.active .event-content {
            border-left-color: var(--accent-blue);
        }

        .event-date {
            font-size: 12px;
            font-weight: 600;
            color: var(--gray-500);
            margin-bottom: 4px;
        }

        .event-title {
            font-family: var(--font-heading);
            font-size: 15px;
            font-weight: 600;
            color: var(--primary-black);
            margin-bottom: 4px;
        }

        .event-category {
            font-size: 12px;
            color: var(--gray-500);
        }

        /* Detail Panel Content */
        .detail-header {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--gray-200);
        }

        .detail-icon {
            width: 56px;
            height: 56px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .detail-icon.meeting { background: rgba(0, 113, 227, 0.1); color: var(--accent-blue); }
        .detail-icon.document { background: rgba(52, 199, 89, 0.1); color: var(--success-green); }
        .detail-icon.decision { background: rgba(255, 149, 0, 0.1); color: var(--warning-orange); }
        .detail-icon.conflict { background: rgba(255, 59, 48, 0.1); color: var(--danger-red); }

        .detail-title-group h3 {
            font-family: var(--font-heading);
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .detail-meta {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .detail-meta-item {
            font-size: 13px;
            color: var(--gray-500);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .detail-body {
            font-size: 15px;
            line-height: 1.8;
            color: var(--gray-700);
        }

        .detail-body p {
            margin-bottom: 16px;
        }

        .detail-body strong {
            color: var(--primary-black);
        }

        .detail-tags {
            display: flex;
            gap: 8px;
            margin-top: 24px;
            flex-wrap: wrap;
        }

        .detail-tag {
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
        }

        .detail-tag.conflict {
            background: rgba(255, 59, 48, 0.1);
            color: var(--danger-red);
        }

        .detail-tag.decision {
            background: rgba(0, 113, 227, 0.1);
            color: var(--accent-blue);
        }

        .detail-tag.document {
            background: rgba(52, 199, 89, 0.1);
            color: var(--success-green);
        }

        /* Tooltip */
        .tooltip {
            position: fixed;
            background: rgba(29, 29, 31, 0.95);
            color: white;
            border-radius: 12px;
            padding: 16px 20px;
            max-width: 400px;
            z-index: 1001;
            opacity: 0;
            pointer-events: none;
            transition: opacity var(--transition-fast);
            box-shadow: var(--shadow-xl);
            line-height: 1.6;
        }

        .tooltip.visible {
            opacity: 1;
        }

        .tooltip-title {
            font-family: var(--font-heading);
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .tooltip-date {
            font-size: 12px;
            opacity: 0.7;
            margin-bottom: 8px;
        }

        .tooltip-body {
            font-size: 13px;
            opacity: 0.9;
        }

        /* Insights Section */
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 24px;
        }

        .insight-card {
            background: var(--primary-white);
            border-radius: 20px;
            padding: 32px;
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-medium);
            border-left: 4px solid transparent;
        }

        .insight-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }

        .insight-card.conflict {
            border-left-color: var(--danger-red);
            background: linear-gradient(135deg, #FFF5F5 0%, #FFFFFF 100%);
        }

        .insight-card.warning {
            border-left-color: var(--warning-orange);
            background: linear-gradient(135deg, #FFFBEB 0%, #FFFFFF 100%);
        }

        .insight-card.info {
            border-left-color: var(--accent-blue);
            background: linear-gradient(135deg, #EFF6FF 0%, #FFFFFF 100%);
        }

        .insight-card.success {
            border-left-color: var(--success-green);
            background: linear-gradient(135deg, #ECFDF5 0%, #FFFFFF 100%);
        }

        .insight-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .insight-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .insight-title {
            font-family: var(--font-heading);
            font-size: 17px;
            font-weight: 600;
        }

        .insight-body {
            font-size: 14px;
            color: var(--gray-700);
            line-height: 1.7;
        }

        /* Conflict Analysis Section */
        .conflict-section {
            background: linear-gradient(135deg, #FFF5F5 0%, #FFFFFF 100%);
            border-radius: 24px;
            padding: 48px;
            margin-top: 48px;
            box-shadow: var(--shadow-md);
        }

        .conflict-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 32px;
        }

        .conflict-icon {
            width: 56px;
            height: 56px;
            background: var(--danger-red);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .conflict-title {
            font-family: var(--font-heading);
            font-size: 24px;
            font-weight: 700;
        }

        .conflict-subtitle {
            font-size: 15px;
            color: var(--gray-700);
        }

        .conflict-timeline {
            position: relative;
            padding-left: 32px;
        }

        .conflict-timeline::before {
            content: '';
            position: absolute;
            left: 11px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--danger-red);
            opacity: 0.3;
        }

        .conflict-item {
            position: relative;
            padding: 20px 0;
        }

        .conflict-item::before {
            content: '';
            position: absolute;
            left: -32px;
            top: 28px;
            width: 24px;
            height: 24px;
            background: var(--primary-white);
            border: 3px solid var(--danger-red);
            border-radius: 50%;
        }

        .conflict-item-date {
            font-size: 13px;
            font-weight: 600;
            color: var(--danger-red);
            margin-bottom: 8px;
        }

        .conflict-item-title {
            font-family: var(--font-heading);
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .conflict-item-desc {
            font-size: 14px;
            color: var(--gray-700);
            line-height: 1.6;
        }

        /* Collapsible Tree Styles */
        .tree-container {
            background: var(--primary-white);
            border-radius: 24px;
            padding: 32px;
            box-shadow: var(--shadow-md);
            margin-top: 48px;
        }

        .tree-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .tree-title {
            font-family: var(--font-heading);
            font-size: 20px;
            font-weight: 600;
        }

        .tree-controls {
            display: flex;
            gap: 12px;
        }

        .node circle {
            cursor: pointer;
            stroke-width: 2px;
            transition: all var(--transition-fast);
        }

        .node:hover circle {
            stroke-width: 4px;
            filter: drop-shadow(0 2px 8px rgba(0,0,0,0.2));
        }

        .node text {
            font-size: 12px;
            pointer-events: none;
            fill: var(--primary-black);
        }

        .link {
            fill: none;
            stroke: var(--gray-300);
            stroke-width: 2px;
        }

        .link-conflict {
            stroke: var(--danger-red);
            stroke-dasharray: 5, 5;
        }

        /* Conclusion Section */
        .conclusion-section {
            background: linear-gradient(135deg, var(--primary-black) 0%, #2c2c2e 100%);
            color: var(--primary-white);
            border-radius: 24px;
            padding: 64px;
            text-align: center;
            margin-top: 48px;
        }

        .conclusion-title {
            font-family: var(--font-heading);
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 24px;
        }

        .conclusion-text {
            font-size: 18px;
            opacity: 0.8;
            max-width: 720px;
            margin: 0 auto 32px;
            line-height: 1.7;
        }

        .conclusion-stats {
            display: flex;
            justify-content: center;
            gap: 48px;
            flex-wrap: wrap;
        }

        .conclusion-stat {
            text-align: center;
        }

        .conclusion-stat-value {
            font-family: var(--font-heading);
            font-size: 48px;
            font-weight: 700;
            color: var(--accent-blue);
        }

        .conclusion-stat-label {
            font-size: 14px;
            opacity: 0.6;
        }

        /* Footer */
        .footer {
            padding: 48px 24px;
            text-align: center;
            border-top: 1px solid var(--gray-200);
            margin-top: 80px;
            background: var(--primary-white);
        }

        .footer-text {
            font-size: 13px;
            color: var(--gray-500);
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 24px;
            margin-top: 16px;
        }

        .footer-links a {
            font-size: 13px;
            color: var(--gray-700);
            text-decoration: none;
            transition: color var(--transition-fast);
        }

        .footer-links a:hover {
            color: var(--accent-blue);
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        .animate-in {
            animation: fadeInUp 0.6s ease-out forwards;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }

            .hero {
                padding: 100px 16px 60px;
            }

            .hero h1 {
                font-size: 28px;
            }

            .section {
                padding: 48px 16px;
            }

            .executive-summary {
                padding: 32px 24px;
            }

            .viz-body {
                padding: 16px;
                min-height: 500px;
            }

            .conflict-section {
                padding: 32px 24px;
            }

            .conclusion-section {
                padding: 48px 24px;
            }

            .vertical-timeline {
                padding-left: 32px;
            }

            .vertical-timeline::before {
                left: 11px;
            }

            .event-marker {
                left: -32px;
                width: 20px;
                height: 20px;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--gray-100);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gray-300);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--gray-500);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav-container">
        <div class="nav-content">
            <a href="#" class="nav-logo">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                </svg>
                รายงานข้อเท็จจริง
            </a>
            <ul class="nav-links">
                <li><a href="#overview" class="active">ภาพรวม</a></li>
                <li><a href="#timeline">ลำดับเหตุการณ์</a></li>
                <li><a href="#conflict-map">แผนผังข้อพิพาท</a></li>
                <li><a href="#insights">ข้อสังเกต</a></li>
                <li><a href="#conclusion">สรุป</a></li>
            </ul>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero" id="overview">
        <div class="hero-badge">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M12 6v6l4 2"/>
            </svg>
            รายงานข้อเท็จจริง
        </div>
        <h1>โครงการเช่าใช้บริการแพลตฟอร์ม<br>เทคโนโลยีดิจิทัล DSL</h1>
        <p class="hero-subtitle">
            การวิเคราะห์ลำดับเหตุการณ์และข้อเท็จจริงเกี่ยวกับการดำเนินการจัดจ้างเช่าใช้บริการแพลตฟอร์มเทคโนโลยีดิจิทัลสำหรับให้บริการระบบ DSL ระยะเวลา ๖๐ เดือน
        </p>
        <div class="hero-meta">
            <div class="meta-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                    <line x1="16" y1="2" x2="16" y2="6"/>
                    <line x1="8" y1="2" x2="8" y2="6"/>
                    <line x1="3" y1="10" x2="21" y2="10"/>
                </svg>
                มิถุนายน - สิงหาคม ๒๕๖๘
            </div>
            <div class="meta-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                </svg>
                นายธนัท ทองอุทัยศรี
            </div>
            <div class="meta-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                </svg>
                ฝ่ายเทคโนโลยีสารสนเทศ
            </div>
        </div>
    </section>

    <!-- Executive Summary Section -->
    <section class="section">
        <div class="executive-summary">
            <div class="section-header" style="text-align: left; margin-bottom: 24px;">
                <div class="section-label">บทสรุปสำหรับผู้บริหาร</div>
                <h2 class="section-title" style="font-size: 28px;">Executive Summary</h2>
            </div>
            
            <p style="font-size: 16px; color: var(--gray-700); margin-bottom: 24px; line-height: 1.8;">
                เอกสารฉบับนี้จัดทำขึ้นเพื่อวิเคราะห์ข้อมูลจากรายงานข้อเท็จจริงของนายธนัท ทองอุทัยศรี โดยมุ่งเน้นการแสดงความเชื่อมโยงของเหตุการณ์ ประเด็นความขัดแย้งในการตีความข้อกำหนด (TOR) และระเบียบพัสดุฯ ที่นำไปสู่การยกเลิกการจัดจ้าง
            </p>

            <div class="summary-grid">
                <div class="summary-card process">
                    <h3>ภาพรวมกระบวนการ</h3>
                    <p>กระบวนการจัดจ้างเริ่มตั้งแต่ 24 มิ.ย. 68 ถึง 28 ส.ค. 68 มีการประชุมรวม 7 ครั้ง มีผู้ยื่นข้อเสนอ 3 ราย กระบวนการมีความซับซ้อนเนื่องจากการตีความข้อกำหนดที่ไม่ตรงกันและการพบข้อบกพร่องของ TOR ในภายหลัง</p>
                </div>
                <div class="summary-card conflict">
                    <h3>จุดแตกหัก (Conflict Origin)</h3>
                    <p>การประชุมครั้งที่ 5/2568 (30 ก.ค. 68) เป็นจุดสำคัญ เมื่อพบว่าผู้ยื่น 2 รายมีเอกสารบุคลากรไม่ครบตาม TOR 12.2 นำไปสู่การโต้แย้งว่าควร "ตกเทคนิค" หรือเพียง "ไม่ได้คะแนน" และส่งผลต่อการบังคับใช้ระเบียบข้อ 75</p>
                </div>
                <div class="summary-card decision">
                    <h3>สาเหตุการยกเลิก</h3>
                    <p>การยกเลิกในการประชุมครั้งที่ 7/2568 มีสาเหตุหลักมาจากการที่ฝ่ายเทคโนโลยีฯ รายงานข้อบกพร่องของ TOR และผู้จัดการกองทุนฯ อนุมัติให้ "ทบทวน TOR" ทำให้ TOR เดิมสิ้นสภาพการบังคับใช้</p>
                </div>
            </div>

            <div class="affirmation">
                "ข้าพเจ้า (นายธนัท ทองอุทัยศรี) ขอยืนยันว่าการปฏิบัติหน้าที่และการสงวนความเห็นแย้ง ได้ดำเนินการโดยสุจริต รอบคอบ ยึดมั่นในระเบียบและ TOR อย่างเคร่งครัด เพื่อรักษาผลประโยชน์สูงสุดของกองทุนฯ และหลักการแข่งขันที่เป็นธรรม มิได้มีการเลือกปฏิบัติหรือใช้ดุลยพินิจโดยปราศจากฐานทางเอกสารรองรับ"
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon blue">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                        <line x1="16" y1="2" x2="16" y2="6"/>
                        <line x1="8" y1="2" x2="8" y2="6"/>
                        <line x1="3" y1="10" x2="21" y2="10"/>
                    </svg>
                </div>
                <div class="stat-value">13</div>
                <div class="stat-label">เหตุการณ์สำคัญ</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon green">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                    </svg>
                </div>
                <div class="stat-value">7</div>
                <div class="stat-label">การประชุมคณะกรรมการ</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon orange">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                    </svg>
                </div>
                <div class="stat-value">3</div>
                <div class="stat-label">ผู้ยื่นข้อเสนอ</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon red">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                        <line x1="12" y1="9" x2="12" y2="13"/>
                        <line x1="12" y1="17" x2="12.01" y2="17"/>
                    </svg>
                </div>
                <div class="stat-value">5</div>
                <div class="stat-label">ประเด็นข้อพิพาท</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon purple">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <polyline points="12 6 12 12 16 14"/>
                    </svg>
                </div>
                <div class="stat-value">66</div>
                <div class="stat-label">วัน (ระยะเวลาดำเนินการ)</div>
            </div>
        </div>
    </section>

    <!-- Timeline Section with Split Panel -->
    <section class="section" id="timeline">
        <div class="section-header">
            <div class="section-label">ลำดับเหตุการณ์</div>
            <h2 class="section-title">Interactive Timeline</h2>
            <p class="section-description">
                คลิกที่เหตุการณ์เพื่อดูรายละเอียด หรือใช้ปุ่มกรองเพื่อแสดงเฉพาะประเภทที่ต้องการ
            </p>
        </div>

        <!-- Filter Pills -->
        <div class="filter-container">
            <button class="filter-pill active" data-filter="all">ทั้งหมด</button>
            <button class="filter-pill" data-filter="meeting">การประชุม</button>
            <button class="filter-pill" data-filter="document">เอกสาร</button>
            <button class="filter-pill" data-filter="decision">มติ/การตัดสินใจ</button>
            <button class="filter-pill conflict" data-filter="conflict">ข้อพิพาท</button>
        </div>

        <div class="split-container">
            <!-- Vertical Timeline -->
            <div class="vertical-timeline-container">
                <div class="vertical-timeline" id="vertical-timeline">
                    <!-- Timeline events will be rendered here -->
                </div>
            </div>

            <!-- Detail Panel -->
            <div class="detail-panel-container" id="detail-panel">
                <div class="detail-panel-placeholder">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 16v-4"/>
                        <path d="M12 8h.01"/>
                    </svg>
                    <p>เลือกเหตุการณ์จาก Timeline<br>เพื่อดูรายละเอียด</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Visualization Section -->
    <section class="section" id="visualization">
        <div class="section-header">
            <div class="section-label">การแสดงผลข้อมูล</div>
            <h2 class="section-title">Dynamic Visualization</h2>
            <p class="section-description">
                เลือกรูปแบบการแสดงผลที่ต้องการ: แนวนอน, รัศมี, หรือลำดับชั้น
            </p>
        </div>

        <!-- Visualization Controls -->
        <div class="viz-controls">
            <button class="viz-btn active" data-view="horizontal">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="3" y1="12" x2="21" y2="12"/>
                    <circle cx="6" cy="12" r="2"/>
                    <circle cx="12" cy="12" r="2"/>
                    <circle cx="18" cy="12" r="2"/>
                </svg>
                แนวนอน
            </button>
            <button class="viz-btn secondary" data-view="radial">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <circle cx="12" cy="12" r="4"/>
                    <line x1="12" y1="2" x2="12" y2="6"/>
                    <line x1="12" y1="18" x2="12" y2="22"/>
                    <line x1="2" y1="12" x2="6" y2="12"/>
                    <line x1="18" y1="12" x2="22" y2="12"/>
                </svg>
                รัศมี (Radial)
            </button>
            <button class="viz-btn secondary" data-view="hierarchy">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="9" y="2" width="6" height="4" rx="1"/>
                    <rect x="2" y="18" width="6" height="4" rx="1"/>
                    <rect x="16" y="18" width="6" height="4" rx="1"/>
                    <line x1="12" y1="6" x2="12" y2="12"/>
                    <line x1="5" y1="12" x2="19" y2="12"/>
                    <line x1="5" y1="12" x2="5" y2="18"/>
                    <line x1="19" y1="12" x2="19" y2="18"/>
                </svg>
                ลำดับชั้น
            </button>
        </div>

        <!-- Visualization Container -->
        <div class="viz-container">
            <div class="viz-header">
                <div class="viz-title">ลำดับเหตุการณ์ มิถุนายน - สิงหาคม ๒๕๖๘</div>
                <div class="viz-legend">
                    <div class="legend-item">
                        <div class="legend-dot" style="background: var(--accent-blue)"></div>
                        การประชุม
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: var(--success-green)"></div>
                        เอกสาร
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: var(--warning-orange)"></div>
                        มติ/การตัดสินใจ
                    </div>
                    <div class="legend-item">
                        <div class="legend-diamond"></div>
                        ข้อพิพาท
                    </div>
                </div>
            </div>
            <div class="viz-body" id="viz-body">
                <svg id="main-viz"></svg>
            </div>
        </div>
    </section>

    <!-- Conflict Map Section -->
    <section class="section" id="conflict-map">
        <div class="tree-container">
            <div class="tree-header">
                <div>
                    <div class="section-label">แผนผังประเด็นข้อพิพาท</div>
                    <h2 class="tree-title">Conflict & Interpretation Map</h2>
                </div>
                <div class="tree-controls">
                    <button class="viz-btn secondary" id="toggle-layout-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <circle cx="12" cy="12" r="4"/>
                        </svg>
                        เปลี่ยนเป็นมุมมองรัศมี
                    </button>
                    <button class="viz-btn secondary" id="expand-all-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="15 3 21 3 21 9"/>
                            <polyline points="9 21 3 21 3 15"/>
                            <line x1="21" y1="3" x2="14" y2="10"/>
                            <line x1="3" y1="21" x2="10" y2="14"/>
                        </svg>
                        ขยายทั้งหมด
                    </button>
                </div>
            </div>
            <p style="color: var(--gray-500); margin-bottom: 24px; font-size: 14px;">
                คลิกที่โหนด (วงกลม) เพื่อขยาย/ยุบรายละเอียด
            </p>
            <div id="conflict-tree-container" style="min-height: 600px; overflow: hidden;">
                <svg id="conflict-tree-svg"></svg>
            </div>
        </div>
    </section>

    <!-- Insights Section -->
    <section class="section" id="insights">
        <div class="section-header">
            <div class="section-label">ข้อสังเกตสำคัญ</div>
            <h2 class="section-title">Key Insights & Analysis</h2>
            <p class="section-description">
                สรุปข้อสังเกตและประเด็นสำคัญจากการดำเนินการจัดจ้างโครงการ
            </p>
        </div>

        <div class="insights-grid">
            <div class="insight-card conflict">
                <div class="insight-header">
                    <div class="insight-icon" style="background: rgba(255, 59, 48, 0.1); color: var(--danger-red);">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                            <line x1="12" y1="9" x2="12" y2="13"/>
                            <line x1="12" y1="17" x2="12.01" y2="17"/>
                        </svg>
                    </div>
                    <div class="insight-title">ความย้อนแย้งในการตีความ TOR ข้อ 12.2</div>
                </div>
                <div class="insight-body">
                    TOR หน้า 48 ระบุเงื่อนไขชัดเจนว่าการขาดเอกสารบุคลากร "...ถือว่าไม่ผ่านข้อเสนอทางเทคนิค" การที่มติเสียงข้างมากตีความว่าเป็นการ "ไม่ได้คะแนน" เป็นการใช้ดุลยพินิจที่ขัดแย้งกับลายลักษณ์อักษร
                </div>
            </div>

            <div class="insight-card warning">
                <div class="insight-header">
                    <div class="insight-icon" style="background: rgba(255, 149, 0, 0.1); color: var(--warning-orange);">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="12" y1="18" x2="12" y2="12"/>
                            <line x1="12" y1="9" x2="12.01" y2="9"/>
                        </svg>
                    </div>
                    <div class="insight-title">ข้อบกพร่องของ TOR ที่ถูกหยิบยกในภายหลัง</div>
                </div>
                <div class="insight-body">
                    ประเด็นข้อบกพร่องของ TOR (เช่น GPU 30 หน่วย/Node, ประกันสังคม) ถูกรายงานโดย ฝทส. หลังจากเกิดข้อพิพาทเรื่องคุณสมบัติบุคลากรแล้ว ทำให้เกิดข้อสังเกตเกี่ยวกับช่วงเวลาในการค้นพบปัญหา
                </div>
            </div>

            <div class="insight-card info">
                <div class="insight-header">
                    <div class="insight-icon" style="background: rgba(0, 113, 227, 0.1); color: var(--accent-blue);">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                        </svg>
                    </div>
                    <div class="insight-title">การหลีกเลี่ยงการบังคับใช้ระเบียบข้อ 75</div>
                </div>
                <div class="insight-body">
                    เมื่อข้อเท็จจริงชี้ว่าเหลือผู้ผ่านเทคนิครายเดียวตาม TOR การพยายามหลีกเลี่ยงการเข้าสู่กระบวนการพิจารณาตามระเบียบข้อ 75 สะท้อนถึงความเสี่ยงด้านธรรมาภิบาลและการถูกตรวจสอบในอนาคต
                </div>
            </div>

            <div class="insight-card success">
                <div class="insight-header">
                    <div class="insight-icon" style="background: rgba(52, 199, 89, 0.1); color: var(--success-green);">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                            <polyline points="22 4 12 14.01 9 11.01"/>
                        </svg>
                    </div>
                    <div class="insight-title">บทบาทของแผนสำรอง (Contingency Plan)</div>
                </div>
                <div class="insight-body">
                    การที่กองทุนฯ มีแผนสำรอง ทำให้ไม่มีความจำเป็นเร่งด่วนที่จะต้องดำเนินการจัดจ้างภายใต้ความเสี่ยงทางกฎหมายและ TOR ที่มีปัญหา ซึ่งสนับสนุนความเห็นแย้งของนายธนัท
                </div>
            </div>

            <div class="insight-card conflict">
                <div class="insight-header">
                    <div class="insight-icon" style="background: rgba(255, 59, 48, 0.1); color: var(--danger-red);">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                        </svg>
                    </div>
                    <div class="insight-title">การสื่อสารกับภายนอกที่ไม่รัดกุม</div>
                </div>
                <div class="insight-body">
                    การที่ประธานฯ มีหนังสือถึง ProEN โดยเปิดเผยรายละเอียดการลงมติและความเห็นต่างภายในในขณะที่ยังไม่มีข้อยุติ เป็นการดำเนินการที่อาจสร้างความเสียเปรียบให้กองทุนฯ ในกรณีพิพาท
                </div>
            </div>

            <div class="insight-card warning">
                <div class="insight-header">
                    <div class="insight-icon" style="background: rgba(255, 149, 0, 0.1); color: var(--warning-orange);">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                            <line x1="12" y1="17" x2="12.01" y2="17"/>
                        </svg>
                    </div>
                    <div class="insight-title">การเปลี่ยนแปลงเหตุผลในการยกเลิก</div>
                </div>
                <div class="insight-body">
                    แม้ข้อพิพาทเริ่มต้นที่การตีความข้อ 75 แต่การยกเลิกในท้ายที่สุดกลับอ้างอิงเหตุผลเรื่อง "TOR มีข้อบกพร่อง" และผู้จัดการกองทุนฯ อนุมัติให้ทบทวน ซึ่งทำให้ TOR เดิมสิ้นสภาพไป
                </div>
            </div>
        </div>

        <!-- Conflict Analysis Section -->
        <div class="conflict-section">
            <div class="conflict-header">
                <div class="conflict-icon">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                        <line x1="12" y1="9" x2="12" y2="13"/>
                        <line x1="12" y1="17" x2="12.01" y2="17"/>
                    </svg>
                </div>
                <div>
                    <div class="conflict-title">ประเด็นข้อพิพาทและความขัดแย้ง</div>
                    <div class="conflict-subtitle">สรุปประเด็นที่นำไปสู่การอุทธรณ์ของบริษัท โปรเอ็น คอร์ป จำกัด (มหาชน)</div>
                </div>
            </div>

            <div class="conflict-timeline">
                <div class="conflict-item">
                    <div class="conflict-item-date">๓๐ กรกฎาคม ๒๕๖๘</div>
                    <div class="conflict-item-title">จุดเริ่มต้นข้อพิพาท - การตีความ TOR ข้อ ๑๒.๒</div>
                    <div class="conflict-item-desc">
                        คณะกรรมการมีความเห็นแตกต่างกันในการตีความว่าผู้ยื่นข้อเสนอที่มีเอกสารบุคลากรไม่ครบถ้วนควรถือว่า "ไม่ผ่านข้อเสนอทางเทคนิค" หรือเพียง "ไม่ได้คะแนนในหมวดนั้น"
                    </div>
                </div>

                <div class="conflict-item">
                    <div class="conflict-item-date">๓๐ กรกฎาคม ๒๕๖๘</div>
                    <div class="conflict-item-title">มติเสียงข้างมาก ๔ ต่อ ๑</div>
                    <div class="conflict-item-desc">
                        คณะกรรมการเสียงข้างมากเห็นว่าทั้ง ๓ บริษัทผ่านคุณสมบัติและข้อเสนอทางเทคนิคแล้ว จึงไม่เข้าเงื่อนไขข้อ ๗๕ ในขณะที่นายธนัท ทองอุทัยศรี สงวนความเห็นแย้ง
                    </div>
                </div>

                <div class="conflict-item">
                    <div class="conflict-item-date">๑ สิงหาคม ๒๕๖๘</div>
                    <div class="conflict-item-title">การเสนอทบทวน TOR</div>
                    <div class="conflict-item-desc">
                        ฝ่ายเทคโนโลยีสารสนเทศเสนอให้ทบทวน TOR เนื่องจากพบข้อบกพร่องหลายประการ และผู้จัดการกองทุนฯ ได้เห็นชอบการทบทวน
                    </div>
                </div>

                <div class="conflict-item">
                    <div class="conflict-item-date">๒๒ สิงหาคม ๒๕๖๘</div>
                    <div class="conflict-item-title">มติยกเลิกการจัดจ้าง</div>
                    <div class="conflict-item-desc">
                        คณะกรรมการเช่าฯ มีมติเห็นชอบให้เสนอผู้จัดการกองทุนฯ ยกเลิกการเชิญเสนอราคาและการจัดจ้าง เนื่องจาก TOR ฉบับเดิมถูกยกเลิก
                    </div>
                </div>

                <div class="conflict-item">
                    <div class="conflict-item-date">๒๓ กันยายน ๒๕๖๘</div>
                    <div class="conflict-item-title">การอุทธรณ์ของบริษัท โปรเอ็นฯ</div>
                    <div class="conflict-item-desc">
                        บริษัท โปรเอ็น คอร์ป จำกัด (มหาชน) ยื่นหนังสืออุทธรณ์เลขที่ PROEN 68/0923-1 คัดค้านคำสั่งยกเลิกการเสนอราคาและการจัดจ้าง
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Conclusion Section -->
    <section class="section" id="conclusion">
        <div class="conclusion-section">
            <h2 class="conclusion-title">สรุปผลการดำเนินการ</h2>
            <p class="conclusion-text">
                การจัดจ้างเช่าใช้บริการแพลตฟอร์มเทคโนโลยีดิจิทัลสำหรับให้บริการระบบ DSL ระยะเวลา ๖๐ เดือน ได้ถูกยกเลิกเนื่องจาก TOR มีข้อบกพร่องหลายประการ และผู้จัดการกองทุนฯ ได้เห็นชอบให้ทบทวน TOR ซึ่งทำให้ TOR ฉบับเดิมไม่สามารถใช้ในการดำเนินการคัดเลือกผู้รับจ้างต่อไปได้
            </p>
            <div class="conclusion-stats">
                <div class="conclusion-stat">
                    <div class="conclusion-stat-value">๖๖</div>
                    <div class="conclusion-stat-label">วัน (ระยะเวลาดำเนินการ)</div>
                </div>
                <div class="conclusion-stat">
                    <div class="conclusion-stat-value">๗</div>
                    <div class="conclusion-stat-label">ครั้ง (การประชุมคณะกรรมการ)</div>
                </div>
                <div class="conclusion-stat">
                    <div class="conclusion-stat-value">๑</div>
                    <div class="conclusion-stat-label">ราย (ผู้ผ่านเกณฑ์ตาม TOR)</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <p class="footer-text">
            รายงานข้อเท็จจริงและลำดับเหตุการณ์ โดย นายธนัท ทองอุทัยศรี<br>
            ผู้เชี่ยวชาญด้านเทคโนโลยีสารสนเทศ กองทุนเงินให้กู้ยืมเพื่อการศึกษา
        </p>
        <div class="footer-links">
            <a href="#">ฝ่ายเทคโนโลยีสารสนเทศ</a>
            <a href="#">กองทุนเงินให้กู้ยืมเพื่อการศึกษา</a>
            <a href="#">พฤศจิกายน ๒๕๖๘</a>
        </div>
    </footer>

    <!-- Tooltip -->
    <div class="tooltip" id="tooltip"></div>

    <script>
        // ==================== DATA ====================
        const timelineData = [
            {
                id: 1,
                date: "2568-06-24",
                dateDisplay: "๒๔ มิ.ย. ๒๕๖๘",
                title: "แต่งตั้งคณะกรรมการเช่าฯ",
                category: "เริ่มต้นโครงการ",
                description: "กองทุนฯ ได้มีคำสั่ง ที่ ๙๙/๒๕๖๘ แต่งตั้งคณะกรรมการเช่าโดยวิธีคัดเลือกโครงการเช่าใช้บริการแพลตฟอร์มเทคโนโลยีดิจิทัลสำหรับให้บริการระบบ DSL ระยะเวลา ๖๐ เดือน นายธนัท ทองอุทัยศรี ได้รับแต่งตั้งเป็นกรรมการ",
                type: "document",
                ref: "ข้อ 2.1",
                color: "#34C759"
            },
            {
                id: 2,
                date: "2568-07-01",
                dateDisplay: "๑ ก.ค. ๒๕๖๘",
                title: "ประชุมครั้งที่ ๑/๒๕๖๘ และ ๒/๒๕๖๘",
                category: "กำหนดหลักเกณฑ์",
                description: "พิจารณากรอบกฎหมายและระเบียบที่เกี่ยวข้อง ร่าง TOR และหลักเกณฑ์การประเมินแบบ Price Performance รวมทั้งพิจารณาคัดเลือกและเห็นชอบรายชื่อผู้ประกอบการที่มีคุณสมบัติเหมาะสมเพื่อเชิญชวนให้ยื่นข้อเสนอ จำนวนทั้งสิ้น ๑๒ ราย",
                type: "meeting",
                ref: "ข้อ 2.2",
                color: "#0071E3"
            },
            {
                id: 3,
                date: "2568-07-02",
                dateDisplay: "๒ ก.ค. ๒๕๖๘",
                title: "ออกหนังสือเชิญชวนเสนอราคา",
                category: "เชิญชวน",
                description: "กองทุนฯ ออกหนังสือเชิญชวนเสนอราคา ที่ กค ๕๑๐๑/ว.๒๒๘๐ ถึงผู้ประกอบการ ๑๒ ราย เพื่อให้ยื่นข้อเสนอภายในวันที่ ๒๒ กรกฎาคม ๒๕๖๘",
                type: "document",
                ref: "ข้อ 2.3",
                color: "#34C759"
            },
            {
                id: 4,
                date: "2568-07-14",
                dateDisplay: "๑๔ ก.ค. ๒๕๖๘",
                title: "ประชุมครั้งที่ ๓/๒๕๖๘",
                category: "ชี้แจง TOR",
                description: "พิจารณาและตอบข้อซักถามเกี่ยวกับ TOR และเงื่อนไขการจัดจ้างจากผู้ประกอบการจำนวน ๘ ราย โดยมอบหมายให้ฝ่ายเลขานุการบันทึกคำชี้แจงและเผยแพร่ผ่านระบบ e-GP",
                type: "meeting",
                ref: "ข้อ 2.4",
                color: "#0071E3"
            },
            {
                id: 5,
                date: "2568-07-22",
                dateDisplay: "๒๒ ก.ค. ๒๕๖๘",
                title: "วันครบกำหนดยื่นข้อเสนอ",
                category: "ยื่นข้อเสนอ",
                description: "มีผู้ยื่นข้อเสนอจำนวน ๓ ราย ได้แก่ (๑) บริษัท โทรคมนาคมแห่งชาติ จำกัด (มหาชน) (๒) บริษัท สิริซอฟต์ จำกัด (มหาชน) (๓) บริษัท โปรเอ็น คอร์ป จำกัด (มหาชน)",
                type: "decision",
                ref: "ข้อ 2.5",
                color: "#FF9500"
            },
            {
                id: 6,
                date: "2568-07-24",
                dateDisplay: "๒๔ ก.ค. ๒๕๖๘",
                title: "ประชุมครั้งที่ ๔/๒๕๖๘",
                category: "พิจารณาผลเบื้องต้น",
                description: "ตรวจสอบคุณสมบัติเบื้องต้นของผู้ยื่นข้อเสนอทั้ง ๓ ราย ทำการเปิดซองราคา และคำนวณคะแนนแบบ Price Performance เบื้องต้น ผลปรากฏว่า บริษัท โปรเอ็นฯ ได้คะแนนรวมสูงสุดจำนวน ๘๕.๑๑๔๙ คะแนน",
                type: "meeting",
                ref: "ข้อ 2.6",
                color: "#0071E3"
            },
            {
                id: 7,
                date: "2568-07-30",
                dateDisplay: "๓๐ ก.ค. ๒๕๖๘",
                title: "ประชุมครั้งที่ ๕/๒๕๖๘ (จุดเริ่มต้นข้อพิพาท)",
                category: "ข้อพิพาทหลัก",
                description: "พบว่า บริษัท โทรคมนาคมแห่งชาติฯ และบริษัท สิริซอฟต์ฯ ยื่นเอกสารบุคลากรไม่ครบถ้วนตาม TOR ข้อ ๑๒.๒ เกิดความเห็นต่างในการตีความ มติเสียงข้างมาก (๔:๑) ให้ดำเนินการต่อ นายธนัท ทองอุทัยศรี สงวนความเห็นแย้ง",
                type: "conflict",
                ref: "ข้อ 2.7, 3.3",
                color: "#FF3B30"
            },
            {
                id: 8,
                date: "2568-07-31",
                dateDisplay: "๓๑ ก.ค. ๒๕๖๘",
                title: "บันทึก ฝอพ.๑๕๒๗/๒๕๖๘",
                category: "การทักท้วง",
                description: "ฝ่ายอำนวยการและพัสดุได้เสนอให้คณะกรรมการเช่าฯ พิจารณาทบทวนผลการพิจารณาเอกสารข้อเสนอ โดยชี้ให้เห็นว่าควรดำเนินการตามระเบียบกระทรวงการคลังฯ ข้อ ๕๖ และข้อ ๗๕",
                type: "document",
                ref: "ข้อ 2.8, 4.1",
                color: "#34C759"
            },
            {
                id: 9,
                date: "2568-08-01",
                dateDisplay: "๑ ส.ค. ๒๕๖๘",
                title: "บันทึก ฝทส.๙๖๑/๒๕๖๘ + ผจก.เห็นชอบทบทวน TOR",
                category: "การทบทวน TOR",
                description: "ฝ่ายเทคโนโลยีสารสนเทศเสนอความเห็นว่า TOR มีข้อบกพร่องในสาระสำคัญหลายประการ (GPU, เอกสารบุคลากร, ประกันสังคม) และแจ้งว่ามีแผนสำรองฉุกเฉิน ผู้จัดการกองทุนฯ เห็นชอบการทบทวน TOR",
                type: "conflict",
                ref: "ข้อ 2.9, 4.2",
                color: "#FF3B30"
            },
            {
                id: 10,
                date: "2568-08-04",
                dateDisplay: "๔ ส.ค. ๒๕๖๘",
                title: "ประชุมครั้งที่ ๖/๒๕๖๘",
                category: "หารือภายนอก",
                description: "มติให้ส่งเรื่องไปยังคณะกรรมการวินิจฉัยปัญหาการจัดซื้อจัดจ้างฯ กรมบัญชีกลาง และขอขยายระยะเวลาการรายงานผล ยังไม่มีมติให้ยกเลิกการจัดจ้าง",
                type: "meeting",
                ref: "ข้อ 2.10, 4.3",
                color: "#0071E3"
            },
            {
                id: 11,
                date: "2568-08-07",
                dateDisplay: "๗ ส.ค. ๒๕๖๘",
                title: "หนังสือชี้แจง ProEN",
                category: "การสื่อสาร (ข้อสังเกต)",
                description: "ประธานคณะกรรมการเช่าฯ มีหนังสือ กค ๕๑๒๒/ว.๒๗๙๑ ถึง ProEN ชี้แจงความคืบหน้า โดยเปิดเผยรายละเอียดความเห็นต่างภายใน (นายธนัททักท้วงภายหลังว่าไม่เหมาะสม)",
                type: "conflict",
                ref: "ข้อ 2.11, 5.1",
                color: "#FF3B30"
            },
            {
                id: 12,
                date: "2568-08-22",
                dateDisplay: "๒๒ ส.ค. ๒๕๖๘",
                title: "ประชุมครั้งที่ ๗/๒๕๖๘: มติยกเลิกการจัดจ้าง",
                category: "การยกเลิก",
                description: "ที่ประชุมสรุปว่า การที่ผู้จัดการกองทุนฯ อนุมัติให้ทบทวน TOR ทำให้ TOR เดิมสิ้นสภาพ ไม่สามารถดำเนินการต่อได้ มติเห็นชอบให้เสนอผู้จัดการกองทุนฯ ยกเลิกการจัดจ้าง",
                type: "decision",
                ref: "ข้อ 2.12, 4.4",
                color: "#FF9500"
            },
            {
                id: 13,
                date: "2568-08-28",
                dateDisplay: "๒๘ ส.ค. ๒๕๖๘",
                title: "แจ้งยกเลิกการจัดจ้าง",
                category: "สิ้นสุดกระบวนการ",
                description: "กองทุนฯ ได้มีหนังสือ ที่ กค ๕๑๐๑/ว.๓๑๓๓ แจ้งผู้ยื่นข้อเสนอทั้ง ๓ รายให้ทราบคำสั่งยกเลิกการเชิญเสนอราคาและการจัดจ้าง",
                type: "document",
                ref: "ข้อ 2.13",
                color: "#34C759"
            }
        ];

        // Conflict Map Data (Hierarchical)
        const conflictData = {
            name: "สาเหตุและข้อพิพาทในการยกเลิกโครงการ DSL",
            type: "root",
            children: [
                {
                    name: "ประเด็นที่ 1: การตีความ TOR ข้อ 12.2",
                    type: "conflict",
                    children: [
                        { name: "ข้อเท็จจริง: NT และ SiriSoft เอกสารไม่ครบ", type: "fact" },
                        { name: "TOR หน้า 48: 'ถือว่าไม่ผ่านข้อเสนอทางเทคนิค'", type: "rule" },
                        {
                            name: "มุมมองที่ 1: ตกเทคนิค (ยึดตาม TOR)",
                            type: "conflict",
                            children: [
                                { name: "ผู้สนับสนุน: นายธนัท, ฝ่ายเลขาฯ, ฝอพ.", type: "actor" },
                                { name: "ผลกระทบ: เหลือผู้ผ่านรายเดียว (ProEN)", type: "impact" }
                            ]
                        },
                        {
                            name: "มุมมองที่ 2: ไม่ตกเทคนิค (แค่ไม่ได้คะแนน)",
                            type: "default",
                            children: [
                                { name: "ผู้สนับสนุน: กรรมการเสียงข้างมาก 4 ท่าน", type: "actor" },
                                { name: "เหตุผล: ผ่าน Qualification เบื้องต้นแล้ว", type: "reason" }
                            ]
                        },
                        { name: "มติ (4:1): ดำเนินการต่อ", type: "decision" }
                    ]
                },
                {
                    name: "ประเด็นที่ 2: การบังคับใช้ระเบียบฯ ข้อ 75",
                    type: "conflict",
                    children: [
                        { name: "ระเบียบข้อ 75: หากเหลือรายเดียว ให้เสนอ 'ยกเลิก'", type: "rule" },
                        { name: "ฝอพ. ทักท้วง (31 ก.ค.)", type: "action" },
                        { name: "มติครั้งที่ 6: ส่งหารือกรมบัญชีกลาง", type: "decision" }
                    ]
                },
                {
                    name: "ประเด็นที่ 3: ข้อบกพร่องของ TOR",
                    type: "decision",
                    children: [
                        {
                            name: "ฝทส. รายงานข้อบกพร่อง (1 ส.ค.)",
                            type: "action",
                            children: [
                                { name: "GPU 30 หน่วย/Node (สับสน)", type: "issue" },
                                { name: "ความไม่สอดคล้องเรื่องเอกสารบุคลากร", type: "issue" },
                                { name: "หลักฐานประกันสังคม (กีดกันรัฐวิสาหกิจ)", type: "issue" }
                            ]
                        },
                        { name: "ผจก. อนุมัติทบทวน TOR", type: "decision" },
                        { name: "มติครั้งที่ 7: ยกเลิกการจัดจ้าง", type: "decision" }
                    ]
                }
            ]
        };

        // ==================== GLOBAL STATE ====================
        let currentView = 'horizontal';
        let currentFilter = 'all';
        let selectedEventId = null;
        let conflictTreeLayout = 'hierarchical';
        const tooltip = d3.select("#tooltip");

        // ==================== UTILITY FUNCTIONS ====================
        function parseBEDate(dateString) {
            const [yearBE, month, day] = dateString.split('-').map(Number);
            return new Date(yearBE - 543, month - 1, day);
        }

        function filterData() {
            if (currentFilter === 'all') return timelineData;
            return timelineData.filter(d => d.type === currentFilter);
        }

        function getTypeLabel(type) {
            const labels = {
                meeting: 'การประชุม',
                document: 'เอกสาร',
                decision: 'มติ/การตัดสินใจ',
                conflict: 'ข้อพิพาท'
            };
            return labels[type] || type;
        }

        function showTooltip(event, d) {
            tooltip.html(`
                <div class="tooltip-title">${d.title}</div>
                <div class="tooltip-date">${d.dateDisplay} - ${d.category}</div>
                <div class="tooltip-body">${d.description}</div>
            `)
            .style("left", (event.pageX + 15) + "px")
            .style("top", (event.pageY - 20) + "px")
            .classed("visible", true);
        }

        function hideTooltip() {
            tooltip.classed("visible", false);
        }

        // ==================== VERTICAL TIMELINE ====================
        function renderVerticalTimeline() {
            const container = document.getElementById('vertical-timeline');
            const filtered = filterData();
            
            container.innerHTML = filtered.map((event, index) => `
                <div class="timeline-event ${selectedEventId === event.id ? 'active' : ''}" 
                     data-id="${event.id}" 
                     style="animation: fadeInUp 0.5s ease-out ${index * 0.1}s both;">
                    <div class="event-marker ${event.type}">
                        <span>${event.id}</span>
                    </div>
                    <div class="event-content">
                        <div class="event-date">${event.dateDisplay}</div>
                        <div class="event-title">${event.title}</div>
                        <div class="event-category">${event.category}</div>
                    </div>
                </div>
            `).join('');

            // Add click handlers
            container.querySelectorAll('.timeline-event').forEach(el => {
                el.addEventListener('click', () => {
                    const id = parseInt(el.dataset.id);
                    selectEvent(id);
                });
            });
        }

        function selectEvent(id) {
            selectedEventId = id;
            const event = timelineData.find(e => e.id === id);
            
            // Update active state
            document.querySelectorAll('.timeline-event').forEach(el => {
                el.classList.toggle('active', parseInt(el.dataset.id) === id);
            });

            // Update detail panel
            const panel = document.getElementById('detail-panel');
            panel.innerHTML = `
                <div class="detail-header">
                    <div class="detail-icon ${event.type}">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            ${event.type === 'meeting' ? '<path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/>' : ''}
                            ${event.type === 'document' ? '<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/>' : ''}
                            ${event.type === 'decision' ? '<circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>' : ''}
                            ${event.type === 'conflict' ? '<path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>' : ''}
                        </svg>
                    </div>
                    <div class="detail-title-group">
                        <h3>${event.title}</h3>
                        <div class="detail-meta">
                            <span class="detail-meta-item">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                    <line x1="16" y1="2" x2="16" y2="6"/>
                                    <line x1="8" y1="2" x2="8" y2="6"/>
                                    <line x1="3" y1="10" x2="21" y2="10"/>
                                </svg>
                                ${event.dateDisplay}
                            </span>
                            <span class="detail-meta-item">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                                </svg>
                                ${event.category}
                            </span>
                        </div>
                    </div>
                </div>
                <div class="detail-body">
                    <p>${event.description}</p>
                    <p><strong>อ้างอิง:</strong> ${event.ref}</p>
                </div>
                <div class="detail-tags">
                    <span class="detail-tag ${event.type}">${getTypeLabel(event.type)}</span>
                </div>
            `;
        }

        // ==================== HORIZONTAL TIMELINE ====================
        function drawHorizontalTimeline() {
            const container = document.getElementById('viz-body');
            const filtered = filterData();
            
            d3.select("#main-viz").selectAll("*").remove();
            
            const width = container.offsetWidth - 64;
            const height = 500;
            const margin = { top: 80, right: 50, bottom: 80, left: 50 };

            const svg = d3.select("#main-viz")
                .attr("width", width)
                .attr("height", height);

            const g = svg.append("g")
                .attr("transform", `translate(${margin.left}, ${margin.top})`);

            const innerWidth = width - margin.left - margin.right;
            const innerHeight = height - margin.top - margin.bottom;

            // X Scale
            const xScale = d3.scalePoint()
                .domain(filtered.map(d => d.id))
                .range([0, innerWidth])
                .padding(0.5);

            // Draw timeline line with gradient
            const gradient = svg.append("defs")
                .append("linearGradient")
                .attr("id", "timeline-gradient")
                .attr("x1", "0%")
                .attr("x2", "100%");

            gradient.append("stop").attr("offset", "0%").attr("stop-color", "#34C759");
            gradient.append("stop").attr("offset", "50%").attr("stop-color", "#FF9500");
            gradient.append("stop").attr("offset", "100%").attr("stop-color", "#FF3B30");

            g.append("line")
                .attr("x1", 0)
                .attr("y1", innerHeight / 2)
                .attr("x2", innerWidth)
                .attr("y2", innerHeight / 2)
                .attr("stroke", "url(#timeline-gradient)")
                .attr("stroke-width", 4)
                .attr("stroke-linecap", "round")
                .attr("opacity", 0.3);

            g.append("line")
                .attr("x1", 0)
                .attr("y1", innerHeight / 2)
                .attr("x2", innerWidth)
                .attr("y2", innerHeight / 2)
                .attr("stroke", "#E8E8ED")
                .attr("stroke-width", 4)
                .attr("stroke-linecap", "round");

            // Draw nodes
            const nodes = g.selectAll(".node")
                .data(filtered)
                .enter()
                .append("g")
                .attr("class", "timeline-node")
                .attr("transform", d => `translate(${xScale(d.id)}, ${innerHeight / 2})`)
                .style("opacity", 0)
                .on("mouseover", (event, d) => showTooltip(event, d))
                .on("mousemove", (event) => {
                    tooltip.style("left", (event.pageX + 15) + "px")
                           .style("top", (event.pageY - 20) + "px");
                })
                .on("mouseout", hideTooltip)
                .on("click", (event, d) => selectEvent(d.id));

            // Animate nodes in
            nodes.transition()
                .duration(500)
                .delay((d, i) => i * 80)
                .style("opacity", 1);

            // Node shapes - circles for regular, diamonds for conflicts
            nodes.each(function(d) {
                const node = d3.select(this);
                if (d.type === 'conflict') {
                    node.append("path")
                        .attr("d", d3.symbol().type(d3.symbolDiamond).size(400))
                        .attr("fill", d.color)
                        .attr("stroke", "white")
                        .attr("stroke-width", 3)
                        .style("filter", "drop-shadow(0 2px 4px rgba(0,0,0,0.15))")
                        .attr("transform", "scale(0)")
                        .transition()
                        .duration(500)
                        .delay((_, i) => i * 80)
                        .attr("transform", "scale(1)");
                } else {
                    node.append("circle")
                        .attr("r", 0)
                        .attr("fill", d.color)
                        .attr("stroke", "white")
                        .attr("stroke-width", 3)
                        .style("filter", "drop-shadow(0 2px 4px rgba(0,0,0,0.15))")
                        .transition()
                        .duration(500)
                        .delay((_, i) => i * 80)
                        .attr("r", 14);
                }
            });

            // Node numbers
            nodes.append("text")
                .attr("text-anchor", "middle")
                .attr("dy", "0.35em")
                .attr("fill", "white")
                .attr("font-size", "11px")
                .attr("font-weight", "bold")
                .text(d => d.id);

            // Date labels (alternating top/bottom)
            nodes.append("text")
                .attr("text-anchor", "middle")
                .attr("y", (d, i) => i % 2 === 0 ? -35 : 35)
                .attr("dy", (d, i) => i % 2 === 0 ? "0" : "0.8em")
                .attr("font-size", "11px")
                .attr("fill", "#86868B")
                .text(d => d.dateDisplay.split(' ').slice(0, 2).join(' '))
                .style("opacity", 0)
                .transition()
                .duration(500)
                .delay((d, i) => i * 80 + 200)
                .style("opacity", 1);

            // Title labels
            nodes.append("text")
                .attr("text-anchor", "middle")
                .attr("y", (d, i) => i % 2 === 0 ? -55 : 55)
                .attr("dy", (d, i) => i % 2 === 0 ? "0" : "0.8em")
                .attr("font-size", "10px")
                .attr("fill", "#1D1D1F")
                .text(d => d.title.length > 18 ? d.title.substring(0, 18) + '...' : d.title)
                .style("opacity", 0)
                .transition()
                .duration(500)
                .delay((d, i) => i * 80 + 300)
                .style("opacity", 1);

            // Connecting lines
            nodes.append("line")
                .attr("x1", 0)
                .attr("y1", (d, i) => i % 2 === 0 ? -20 : 20)
                .attr("x2", 0)
                .attr("y2", (d, i) => i % 2 === 0 ? -28 : 28)
                .attr("stroke", d => d.color)
                .attr("stroke-width", 2)
                .attr("stroke-dasharray", "3,2")
                .style("opacity", 0)
                .transition()
                .duration(500)
                .delay((d, i) => i * 80 + 100)
                .style("opacity", 0.5);
        }

        // ==================== RADIAL TIMELINE ====================
        function drawRadialTimeline() {
            const container = document.getElementById('viz-body');
            const filtered = filterData();
            
            d3.select("#main-viz").selectAll("*").remove();
            
            const width = container.offsetWidth - 64;
            const height = 600;
            const radius = Math.min(width, height) / 2 - 100;

            const svg = d3.select("#main-viz")
                .attr("width", width)
                .attr("height", height);

            const g = svg.append("g")
                .attr("transform", `translate(${width / 2}, ${height / 2})`);

            // Angle scale
            const angleScale = d3.scalePoint()
                .domain(filtered.map(d => d.id))
                .range([0, 2 * Math.PI - (2 * Math.PI / filtered.length)]);

            // Draw center circle
            g.append("circle")
                .attr("r", 0)
                .attr("fill", "#1D1D1F")
                .transition()
                .duration(500)
                .attr("r", 50);

            g.append("text")
                .attr("text-anchor", "middle")
                .attr("dy", "-0.3em")
                .attr("fill", "white")
                .attr("font-size", "14px")
                .attr("font-weight", "600")
                .text("DSL")
                .style("opacity", 0)
                .transition()
                .duration(500)
                .delay(200)
                .style("opacity", 1);

            g.append("text")
                .attr("text-anchor", "middle")
                .attr("dy", "1.2em")
                .attr("fill", "white")
                .attr("font-size", "11px")
                .text("Platform")
                .style("opacity", 0)
                .transition()
                .duration(500)
                .delay(200)
                .style("opacity", 1);

            // Draw connecting lines
            filtered.forEach((d, i) => {
                const angle = angleScale(d.id) - Math.PI / 2;
                const x = Math.cos(angle) * radius;
                const y = Math.sin(angle) * radius;

                g.append("line")
                    .attr("x1", Math.cos(angle) * 55)
                    .attr("y1", Math.sin(angle) * 55)
                    .attr("x2", Math.cos(angle) * 55)
                    .attr("y2", Math.sin(angle) * 55)
                    .attr("stroke", d.color)
                    .attr("stroke-width", 2)
                    .attr("opacity", 0.4)
                    .transition()
                    .duration(500)
                    .delay(i * 50)
                    .attr("x2", x)
                    .attr("y2", y);
            });

            // Draw nodes
            const nodes = g.selectAll(".radial-node")
                .data(filtered)
                .enter()
                .append("g")
                .attr("class", "timeline-node")
                .attr("transform", d => {
                    const angle = angleScale(d.id) - Math.PI / 2;
                    return `translate(${Math.cos(angle) * radius}, ${Math.sin(angle) * radius})`;
                })
                .style("opacity", 0)
                .on("mouseover", (event, d) => showTooltip(event, d))
                .on("mousemove", (event) => {
                    tooltip.style("left", (event.pageX + 15) + "px")
                           .style("top", (event.pageY - 20) + "px");
                })
                .on("mouseout", hideTooltip)
                .on("click", (event, d) => selectEvent(d.id));

            nodes.transition()
                .duration(500)
                .delay((d, i) => i * 50 + 300)
                .style("opacity", 1);

            // Node shapes
            nodes.each(function(d) {
                const node = d3.select(this);
                if (d.type === 'conflict') {
                    node.append("path")
                        .attr("d", d3.symbol().type(d3.symbolDiamond).size(500))
                        .attr("fill", d.color)
                        .attr("stroke", "white")
                        .attr("stroke-width", 3)
                        .style("filter", "drop-shadow(0 2px 6px rgba(0,0,0,0.2))");
                } else {
                    node.append("circle")
                        .attr("r", 18)
                        .attr("fill", d.color)
                        .attr("stroke", "white")
                        .attr("stroke-width", 3)
                        .style("filter", "drop-shadow(0 2px 6px rgba(0,0,0,0.2))");
                }
            });

            // Node numbers
            nodes.append("text")
                .attr("text-anchor", "middle")
                .attr("dy", "0.35em")
                .attr("fill", "white")
                .attr("font-size", "12px")
                .attr("font-weight", "bold")
                .text(d => d.id);

            // Labels
            nodes.append("text")
                .attr("text-anchor", d => {
                    const angle = angleScale(d.id) - Math.PI / 2;
                    return Math.cos(angle) > 0 ? "start" : "end";
                })
                .attr("x", d => {
                    const angle = angleScale(d.id) - Math.PI / 2;
                    return Math.cos(angle) > 0 ? 28 : -28;
                })
                .attr("dy", "0.35em")
                .attr("font-size", "10px")
                .attr("fill", "#1D1D1F")
                .text(d => d.dateDisplay.split(' ').slice(0, 2).join(' '));
        }

        // ==================== HIERARCHY TIMELINE ====================
        function drawHierarchyTimeline() {
            const container = document.getElementById('viz-body');
            
            d3.select("#main-viz").selectAll("*").remove();
            
            const width = container.offsetWidth - 64;
            const height = 600;
            const margin = { top: 40, right: 150, bottom: 40, left: 150 };

            const svg = d3.select("#main-viz")
                .attr("width", width)
                .attr("height", height);

            const g = svg.append("g")
                .attr("transform", `translate(${margin.left}, ${margin.top})`);

            const innerWidth = width - margin.left - margin.right;
            const innerHeight = height - margin.top - margin.bottom;

            // Create hierarchy data
            const hierarchyData = {
                name: "โครงการ DSL Platform",
                children: [
                    { name: "เริ่มต้น", children: timelineData.slice(0, 4).map(d => ({ name: d.title, type: d.type, data: d })) },
                    { name: "พิจารณาข้อเสนอ", children: timelineData.slice(4, 6).map(d => ({ name: d.title, type: d.type, data: d })) },
                    { name: "ข้อพิพาท", children: timelineData.slice(6, 11).map(d => ({ name: d.title, type: d.type, data: d })) },
                    { name: "ยกเลิก", children: timelineData.slice(11).map(d => ({ name: d.title, type: d.type, data: d })) }
                ]
            };

            const root = d3.hierarchy(hierarchyData);
            const tree = d3.tree().size([innerHeight, innerWidth]);
            tree(root);

            // Draw links
            g.selectAll(".link")
                .data(root.links())
                .enter()
                .append("path")
                .attr("class", "link")
                .attr("d", d3.linkHorizontal().x(d => d.y).y(d => d.x))
                .attr("stroke-dasharray", function() {
                    return this.getTotalLength();
                })
                .attr("stroke-dashoffset", function() {
                    return this.getTotalLength();
                })
                .transition()
                .duration(1000)
                .attr("stroke-dashoffset", 0);

            // Draw nodes
            const nodes = g.selectAll(".node")
                .data(root.descendants())
                .enter()
                .append("g")
                .attr("class", "node")
                .attr("transform", d => `translate(${d.y}, ${d.x})`)
                .style("opacity", 0)
                .on("mouseover", (event, d) => {
                    if (d.data.data) showTooltip(event, d.data.data);
                })
                .on("mousemove", (event) => {
                    tooltip.style("left", (event.pageX + 15) + "px")
                           .style("top", (event.pageY - 20) + "px");
                })
                .on("mouseout", hideTooltip)
                .on("click", (event, d) => {
                    if (d.data.data) selectEvent(d.data.data.id);
                });

            nodes.transition()
                .duration(500)
                .delay((d, i) => i * 50)
                .style("opacity", 1);

            // Node circles
            nodes.append("circle")
                .attr("r", d => d.children ? 20 : 12)
                .attr("fill", d => {
                    if (!d.data.type) return "#1D1D1F";
                    const colors = {
                        meeting: "#0071E3",
                        document: "#34C759",
                        decision: "#FF9500",
                        conflict: "#FF3B30"
                    };
                    return colors[d.data.type] || "#86868B";
                })
                .attr("stroke", "white")
                .attr("stroke-width", 2);

            // Node labels
            nodes.append("text")
                .attr("dy", "0.35em")
                .attr("x", d => d.children ? -25 : 18)
                .attr("text-anchor", d => d.children ? "end" : "start")
                .attr("font-size", "11px")
                .attr("fill", "#1D1D1F")
                .text(d => d.data.name.length > 25 ? d.data.name.substring(0, 25) + '...' : d.data.name);
        }

        // ==================== CONFLICT TREE ====================
        let conflictRoot, conflictSvg, conflictG;
        let nodeIdCounter = 0;
        const duration = 750;

        function initConflictTree() {
            const container = document.getElementById('conflict-tree-container');
            const width = container.offsetWidth;
            const height = 700;

            d3.select("#conflict-tree-svg").selectAll("*").remove();

            conflictSvg = d3.select("#conflict-tree-svg")
                .attr("width", width)
                .attr("height", height);

            conflictG = conflictSvg.append("g")
                .attr("transform", "translate(150, 50)");

            conflictRoot = d3.hierarchy(conflictData);
            conflictRoot.x0 = height / 2;
            conflictRoot.y0 = 0;

            // Collapse after first level
            if (conflictRoot.children) {
                conflictRoot.children.forEach(collapse);
            }

            updateConflictTree(conflictRoot);
        }

        function collapse(d) {
            if (d.children) {
                d._children = d.children;
                d._children.forEach(collapse);
                d.children = null;
            }
        }

        function expandAll(d) {
            if (d._children) {
                d.children = d._children;
                d._children = null;
            }
            if (d.children) {
                d.children.forEach(expandAll);
            }
        }

        function getNodeColor(d) {
            const colors = {
                root: "#1D1D1F",
                conflict: "#FF3B30",
                rule: "#0071E3",
                fact: "#4ECDC4",
                decision: "#FF9500",
                actor: "#AF52DE",
                action: "#34C759",
                issue: "#FF9500",
                impact: "#FF3B30",
                reason: "#86868B",
                default: "#E8E8ED"
            };
            return colors[d.data.type] || colors.default;
        }

        function updateConflictTree(source) {
            const container = document.getElementById('conflict-tree-container');
            const width = container.offsetWidth - 300;
            const height = 650;

            let treeLayout, linkGenerator;

            if (conflictTreeLayout === 'hierarchical') {
                treeLayout = d3.tree().size([height, width]);
                linkGenerator = d3.linkHorizontal().x(d => d.y).y(d => d.x);
                conflictG.transition().duration(duration)
                    .attr("transform", "translate(150, 20)");
            } else {
                const radius = Math.min(width, height) / 2 - 50;
                treeLayout = d3.tree()
                    .size([2 * Math.PI, radius])
                    .separation((a, b) => (a.parent == b.parent ? 1 : 2) / a.depth);
                linkGenerator = d3.linkRadial().angle(d => d.x).radius(d => d.y);
                conflictG.transition().duration(duration)
                    .attr("transform", `translate(${container.offsetWidth / 2}, ${height / 2})`);
            }

            const treeData = treeLayout(conflictRoot);
            const nodes = treeData.descendants();
            const links = treeData.descendants().slice(1);

            if (conflictTreeLayout === 'hierarchical') {
                nodes.forEach(d => { d.y = d.depth * 200; });
            }

            // Links
            const link = conflictG.selectAll('path.link')
                .data(links, d => d.id || (d.id = ++nodeIdCounter));

            const linkEnter = link.enter().insert('path', 'g')
                .attr('class', d => `link ${d.data.type === 'conflict' ? 'link-conflict' : ''}`)
                .attr('d', d => {
                    const o = { x: source.x0, y: source.y0 };
                    return linkGenerator({ source: o, target: o });
                });

            linkEnter.merge(link)
                .transition()
                .duration(duration)
                .attr('d', d => linkGenerator({ source: d.parent, target: d }));

            link.exit()
                .transition()
                .duration(duration)
                .attr('d', d => {
                    const o = { x: source.x, y: source.y };
                    return linkGenerator({ source: o, target: o });
                })
                .remove();

            // Nodes
            const node = conflictG.selectAll('g.node')
                .data(nodes, d => d.id || (d.id = ++nodeIdCounter));

            const nodeEnter = node.enter().append('g')
                .attr('class', 'node')
                .attr('transform', d => getTransform(source.x0, source.y0))
                .on('click', (event, d) => {
                    if (d.children) {
                        d._children = d.children;
                        d.children = null;
                    } else {
                        d.children = d._children;
                        d._children = null;
                    }
                    updateConflictTree(d);
                });

            nodeEnter.append('circle')
                .attr('r', 1e-6)
                .style('fill', d => d._children ? getNodeColor(d) : '#fff')
                .attr('stroke', d => getNodeColor(d));

            nodeEnter.append('text')
                .attr('dy', '.35em');

            const nodeUpdate = nodeEnter.merge(node);

            nodeUpdate.transition()
                .duration(duration)
                .attr('transform', d => getTransform(d.x, d.y));

            nodeUpdate.select('circle')
                .attr('r', 10)
                .style('fill', d => d._children ? getNodeColor(d) : '#fff')
                .attr('stroke', d => getNodeColor(d));

            if (conflictTreeLayout === 'radial') {
                nodeUpdate.select('text')
                    .transition().duration(duration)
                    .attr('transform', d => d.x >= Math.PI ? 'rotate(180)' : null)
                    .attr('x', d => d.x < Math.PI === !d.children ? 15 : -15)
                    .attr('text-anchor', d => d.x < Math.PI === !d.children ? 'start' : 'end')
                    .text(d => d.data.name.length > 30 ? d.data.name.substring(0, 30) + '...' : d.data.name);
            } else {
                nodeUpdate.select('text')
                    .transition().duration(duration)
                    .attr('transform', 'rotate(0)')
                    .attr('x', d => d.children || d._children ? -15 : 15)
                    .attr('text-anchor', d => d.children || d._children ? 'end' : 'start')
                    .text(d => d.data.name.length > 35 ? d.data.name.substring(0, 35) + '...' : d.data.name);
            }

            const nodeExit = node.exit()
                .transition()
                .duration(duration)
                .attr('transform', d => getTransform(source.x, source.y))
                .remove();

            nodeExit.select('circle').attr('r', 1e-6);
            nodeExit.select('text').style('fill-opacity', 1e-6);

            nodes.forEach(d => {
                d.x0 = d.x;
                d.y0 = d.y;
            });
        }

        function getTransform(x, y) {
            if (x === undefined || y === undefined || isNaN(x) || isNaN(y)) {
                x = 0; y = 0;
            }
            if (conflictTreeLayout === 'hierarchical') {
                return `translate(${y},${x})`;
            } else {
                return `rotate(${(x * 180 / Math.PI - 90) || 0}) translate(${y},0)`;
            }
        }

        // ==================== EVENT HANDLERS ====================
        function switchView(view) {
            currentView = view;
            
            document.querySelectorAll('[data-view]').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.add('secondary');
            });
            document.querySelector(`[data-view="${view}"]`).classList.remove('secondary');
            document.querySelector(`[data-view="${view}"]`).classList.add('active');

            if (view === 'horizontal') {
                drawHorizontalTimeline();
            } else if (view === 'radial') {
                drawRadialTimeline();
            } else if (view === 'hierarchy') {
                drawHierarchyTimeline();
            }
        }

        function filterEvents(filter) {
            currentFilter = filter;
            
            document.querySelectorAll('[data-filter]').forEach(pill => {
                pill.classList.remove('active');
            });
            document.querySelector(`[data-filter="${filter}"]`).classList.add('active');

            renderVerticalTimeline();
            
            if (currentView === 'horizontal') {
                drawHorizontalTimeline();
            } else if (currentView === 'radial') {
                drawRadialTimeline();
            }
        }

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            // Render vertical timeline
            renderVerticalTimeline();
            
            // Draw initial visualization
            drawHorizontalTimeline();
            
            // Initialize conflict tree
            initConflictTree();

            // Setup view buttons
            document.querySelectorAll('[data-view]').forEach(btn => {
                btn.addEventListener('click', () => switchView(btn.dataset.view));
            });

            // Setup filter buttons
            document.querySelectorAll('[data-filter]').forEach(pill => {
                pill.addEventListener('click', () => filterEvents(pill.dataset.filter));
            });

            // Toggle layout button
            document.getElementById('toggle-layout-btn').addEventListener('click', function() {
                conflictG.selectAll("*").interrupt();
                if (conflictTreeLayout === 'hierarchical') {
                    conflictTreeLayout = 'radial';
                    this.innerHTML = `
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="2" width="6" height="4" rx="1"/>
                            <rect x="2" y="18" width="6" height="4" rx="1"/>
                            <rect x="16" y="18" width="6" height="4" rx="1"/>
                        </svg>
                        เปลี่ยนเป็นมุมมองลำดับชั้น
                    `;
                } else {
                    conflictTreeLayout = 'hierarchical';
                    this.innerHTML = `
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <circle cx="12" cy="12" r="4"/>
                        </svg>
                        เปลี่ยนเป็นมุมมองรัศมี
                    `;
                }
                updateConflictTree(conflictRoot);
            });

            // Expand all button
            document.getElementById('expand-all-btn').addEventListener('click', function() {
                expandAll(conflictRoot);
                updateConflictTree(conflictRoot);
            });

            // Scroll spy for navigation
            const sections = document.querySelectorAll('section[id]');
            const navLinks = document.querySelectorAll('.nav-links a');

            window.addEventListener('scroll', () => {
                let current = '';
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    if (scrollY >= sectionTop - 100) {
                        current = section.getAttribute('id');
                    }
                });

                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href') === `#${current}`) {
                        link.classList.add('active');
                    }
                });
            });

            // Smooth scroll for navigation links
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = link.getAttribute('href');
                    const target = document.querySelector(targetId);
                    if (target) {
                        target.scrollIntoView({ behavior: 'smooth' });
                    }
                });
            });
        });

        // Handle window resize
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                if (currentView === 'horizontal') {
                    drawHorizontalTimeline();
                } else if (currentView === 'radial') {
                    drawRadialTimeline();
                } else if (currentView === 'hierarchy') {
                    drawHierarchyTimeline();
                }
                initConflictTree();
            }, 250);
        });
    </script>
</body>
</html>
