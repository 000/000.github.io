<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>รายงานข้อเท็จจริงและลำดับเหตุการณ์โครงการเช่าใช้บริการแพลตฟอร์ม DSL 60 เดือน</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&family=Prompt:wght@600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #f8f9fc;
            --card: #ffffff;
            --text: #1a1a1a;
            --primary: #2563eb;
            --accent: #dc2626;
            --success: #16a34a;
            --warning: #ca8a04;
            --info: #0d9488;
            --gray: #6b7280;
            --light: #e5e7eb;
        }
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: 'Sarabun', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }
        header {
            background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
            color: white;
            text-align: center;
            padding: 80px 20px;
        }
        h1 { font-family: 'Prompt', sans-serif; font-size: 2.8rem; margin-bottom: 16px; }
        h2 { font-family: 'Prompt', sans-serif; font-size: 2rem; color: var(--primary); margin: 40px 0 20px; }
        .container { max-width: 1600px; margin: 0 auto; padding: 0 20px; }
        .section { background: var(--card); border-radius: 24px; padding: 40px; margin-bottom: 40px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); }
        .controls {
            display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; margin: 30px 0;
        }
        .btn {
            padding: 12px 24px; border: none; border-radius: 12px; font-weight: 600; cursor: pointer;
            background: var(--light); color: var(--text); transition: all 0.3s;
        }
        .btn.active, .btn:hover { background: var(--primary); color: white; }
        .filter-btn { background: var(--light); }
        .filter-btn.active { background: var(--accent); color: white; }
        #timeline-svg, #radial-svg, #hierarchy-svg { width: 100%; height: 700px; background: white; border-radius: 16px; }
        .node circle { cursor: pointer; stroke: white; stroke-width: 3px; }
        .node text { font-size: 12px; pointer-events: none; }
        .link { fill: none; stroke: #ccc; stroke-width: 2px; }
        .tooltip {
            position: absolute; background: rgba(0,0,0,0.85); color: white; padding: 16px; border-radius: 12px;
            font-size: 14px; max-width: 400px; pointer-events: none; opacity: 0; transition: opacity 0.2s;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .legend { display: flex; justify-content: center; flex-wrap: wrap; gap: 20px; margin: 20px 0; }
        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 14px; }
        .legend-color { width: 16px; height: 16px; border-radius: 50%; }
    </style>
</head>
<body>
<header>
    <h1>รายงานข้อเท็จจริงและลำดับเหตุการณ์<br>โครงการเช่าใช้บริการแพลตฟอร์มเทคโนโลยีดิจิทัลสำหรับระบบ DSL (60 เดือน)</h1>
    <p>โดย นายธนัท ทองอุทัยศรี • พฤศจิกายน 2568</p>
</header>

<div class="container">
    <div class="section">
        <h2>ลำดับเหตุการณ์สำคัญ (Interactive Timeline)</h2>
        <div class="controls">
            <button class="btn active" data-view="timeline">แนวนอน</button>
            <button class="btn" data-view="radial">รัศมี</button>
            <button class="btn" data-view="hierarchy">ลำดับชั้น</button>
        </div>
        <div class="controls">
            <button class="filter-btn active" data-filter="all">ทั้งหมด</button>
            <button class="filter-btn" data-filter="meeting">การประชุม</button>
            <button class="filter-btn" data-filter="document">เอกสาร</button>
            <button class="filter-btn" data-filter="decision">มติ</button>
            <button class="filter-btn" data-filter="conflict">ข้อพิพาท</button>
        </div>
        <div class="legend">
            <div class="legend-item"><div class="legend-color" style="background:#2563eb"></div>การประชุม</div>
            <div class="legend-item"><div class="legend-color" style="background:#16a34a"></div>เอกสาร</div>
            <div class="legend-item"><div class="legend-color" style="background:#ca8a04"></div>มติ/ตัดสินใจ</div>
            <div class="legend-item"><div class="legend-color" style="background:#dc2626"></div>ข้อพิพาท</div>
        </div>
        <svg id="timeline-svg"></svg>
        <svg id="radial-svg" style="display:none"></svg>
        <svg id="hierarchy-svg" style="display:none"></svg>
    </div>

    <div class="section">
        <h2>ข้อสังเกตและประเด็นสำคัญ</h2>
        <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(320px,1fr)); gap:24px;">
            <div style="background:#fee2e2; padding:24px; border-radius:16px; border-left:6px solid #dc2626;">
                <h3 style="color:#dc2626; margin-bottom:12px;">เอกสารบุคลากรไม่ครบถ้วน</h3>
                <p>บริษัท โทรคมนาคมแห่งชาติฯ และ สิริซอฟต์ฯ ยื่นเอกสารบุคลากรไม่ครบตาม TOR หน้า 48 → ตามตัวบทต้องถือว่า <strong>ไม่ผ่านข้อเสนอทางเทคนิค</strong></p>
            </div>
            <div style="background:#fef3c7; padding:24px; border-radius:16px; border-left:6px solid #ca8a04;">
                <h3 style="color:#ca8a04; margin-bottom:12px;">ข้อบกพร่องใน TOR</h3>
                <p>พบปัญหา GPU 30 หน่วย/Node, ความไม่สอดคล้องของเงื่อนไขเอกสารบุคลากร และหลักฐานประกันสังคมที่อาจกีดกันรัฐวิสาหกิจ</p>
            </div>
            <div style="background:#dbeafe; padding:24px; border-radius:16px; border-left:6px solid #2563eb;">
                <h3 style="color:#2563eb; margin-bottom:12px;">มติเสียงข้างมาก vs เสียงข้างน้อย</h3>
                <p>มติ 4:1 ให้ดำเนินการต่อโดยไม่ถือว่าเหลือผู้ผ่านรายเดียว → นายธนัท ทองอุทัยศรี สงวนความเห็นแย้ง</p>
            </div>
            <div style="background:#dcfce7; padding:24px; border-radius:16px; border-left:6px solid #16a34a;">
                <h3 style="color:#16a34a; margin-bottom:12px;">แผนสำรองฉุกเฉิน</h3>
                <p>กองทุนฯ มีแผนเช่าโครงสร้างพื้นฐานเดิมต่อ 12 เดือน → ไม่มีความเร่งด่วนต้องเดินหน้าโครงการภายใต้ TOR ที่มีปัญหา</p>
            </div>
        </div>
    </div>
</div>

<div class="tooltip" id="tooltip"></div>

<script>
const data = [
    {id:1, date:"2025-06-24", title:"แต่งตั้งคณะกรรมการ", desc:"คำสั่งที่ 99/2568 แต่งตั้งคณะกรรมการเช่าโดยวิธีคัดเลือก", type:"document", color:"#16a34a"},
    {id:2, date:"2025-07-01", title:"ประชุมครั้งที่ 1-2/2568", desc:"พิจารณา TOR และคัดเลือกผู้ประกอบการ 12 ราย", type:"meeting", color:"#2563eb"},
    {id:3, date:"2025-07-02", title:"ออกหนังสือเชิญชวน", desc:"กค 5101/ว.2280 เชิญ 12 ราย ยื่นภายใน 22 ก.ค.", type:"document", color:"#16a34a"},
    {id:4, date:"2025-07-14", title:"ประชุมครั้งที่ 3/2568", desc:"ตอบข้อซักถาม TOR เผยแพร่ผ่าน e-GP", type:"meeting", color:"#2563eb"},
    {id:5, date:"2025-07-22", title:"ยื่นข้อเสนอ", desc:"มี 3 ราย: NT, SiriSoft, ProEN", type:"decision", color:"#ca8a04"},
    {id:6, date:"2025-07-24", title:"ประชุมครั้งที่ 4/2568", desc:"ProEN ได้คะแนนสูงสุด 85.1149", type:"meeting", color:"#2563eb"},
    {id:7, date:"2025-07-30", title:"ประชุมครั้งที่ 5/2568 (จุดเริ่มต้นพิพาท)", desc:"พบเอกสารบุคลากรไม่ครบ 2 ราย มติ 4:1 ดำเนินการต่อ นายธนัทสงวนความเห็น", type:"conflict", color:"#dc2626"},
    {id:8, date:"2025-07-31", title:"ฝอพ.1527/2568", desc:"เสนอทบทวนมติตาม TOR และระเบียบข้อ 75", type:"document", color:"#16a34a"},
    {id:9, date:"2025-08-01", title:"ฝทส.961/2568 + ผจก.เห็นชอบทบทวน TOR", desc:"พบข้อบกพร่อง TOR และมีแผนสำรอง", type:"conflict", color:"#dc2626"},
    {id:10, date:"2025-08-04", title:"ประชุมครั้งที่ 6/2568", desc:"มติส่งเรื่องกรมบัญชีกลาง + ขอขยายเวลา", type:"meeting", color:"#2563eb"},
    {id:11, date:"2025-08-07", title:"หนังสือแจ้ง ProEN", desc:"กค 5122/ว.2791 ชี้แจงความเห็นต่างภายใน", type:"conflict", color:"#dc2626"},
    {id:12, date:"2025-08-22", title:"ประชุมครั้งที่ 7/2568", desc:"มติยกเลิกการจัดจ้าง เนื่องจาก TOR เดิมถูกยกเลิก", type:"decision", color:"#ca8a04"},
    {id:13, date:"2025-08-28", title:"แจ้งยกเลิกการจัดจ้าง", desc:"กค 5101/ว.3133 แจ้งทั้ง 3 ราย", type:"document", color:"#16a34a"}
];

let currentView = 'timeline';
let currentFilter = 'all';
const tooltip = d3.select("#tooltip");

function filterData() {
    return currentFilter === 'all' ? data : data.filter(d => d.type === currentFilter);
}

function drawTimeline() {
    const filtered = filterData();
    d3.select("#timeline-svg").selectAll("*").remove();
    const width = 1400, height = 600;
    const margin = {top:80, right:50, bottom:50, left:50};
    const svg = d3.select("#timeline-svg").attr("viewBox", `0 0 ${width} ${height}`);
    const g = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);

    const x = d3.scalePoint()
        .domain(filtered.map(d => d.id))
        .range([0, width - margin.left - margin.right]);

    // Line
    g.append("line")
        .attr("x1", 0).attr("x2", width - margin.left - margin.right)
        .attr("y1", height/2 - margin.top).attr("y2", height/2 - margin.top)
        .attr("stroke", "#ddd").attr("stroke-width", 4);

    const nodes = g.selectAll(".node")
        .data(filtered)
        .enter().append("g")
        .attr("class", "node")
        .attr("transform", d => `translate(${x(d.id)}, ${height/2 - margin.top})`)
        .on("mouseover", (e,d) => showTooltip(e,d))
        .on("mousemove", e => tooltip.style("left", (e.pageX+15)+"px").style("top", (e.pageY-20)+"px"))
        .on("mouseout", () => tooltip.style("opacity",0));

    nodes.append("circle").attr("r", 16).attr("fill", d=>d.color);
    nodes.append("text").attr("dy", ".35em").attr("text-anchor","middle").attr("fill","white").text(d=>d.id);

    nodes.append("text")
        .attr("y", d => d.id%2===0 ? -40 : 50)
        .attr("text-anchor","middle")
        .text(d=>d.date.split("-").slice(1).join("/").replace("-","/"));

    nodes.append("text")
        .attr("y", d => d.id%2===0 ? -20 : 70)
        .attr("text-anchor","middle")
        .style("font-size","14px")
        .text(d=>d.title.length>25 ? d.title.substring(0,25)+"..." : d.title);
}

function drawRadial() {
    const filtered = filterData();
    d3.select("#radial-svg").selectAll("*").remove();
    const width = 1400, height = 700;
    const radius = Math.min(width, height)/2 - 100;
    const svg = d3.select("#radial-svg").attr("viewBox", `0 0 ${width} ${height}`);
    const g = svg.append("g").attr("transform", `translate(${width/2},${height/2})`);

    const angle = d3.scalePoint()
        .domain(filtered.map(d=>d.id))
        .range([0, 2*Math.PI]);

    // Links from center
    g.selectAll(".link")
        .data(filtered)
        .enter().append("line")
        .attr("x1",0).attr("y1",0)
        .attr("x2", d => Math.cos(angle(d.id)-Math.PI/2)*radius*0.8)
        .attr("y2", d => Math.sin(angle(d.id)-Math.PI/2)*radius*0.8)
        .attr("stroke", d=>d.color).attr("stroke-width",3).attr("opacity",0.4);

    const nodes = g.selectAll(".node")
        .data(filtered)
        .enter().append("g")
        .attr("transform", d => `rotate(${angle(d.id)*180/Math.PI - 90}) translate(${radius},0)`)
        .on("mouseover", (e,d) => showTooltip(e,d))
        .on("mousemove", e => tooltip.style("left", (e.pageX+15)+"px").style("top", (e.pageY-20)+"px"))
        .on("mouseout", () => tooltip.style("opacity",0));

    nodes.append("circle").attr("r",20).attr("fill",d=>d.color);
    nodes.append("text").attr("dy",".35em").attr("text-anchor","middle").attr("fill","white").style("font-weight","bold").text(d=>d.id);
    nodes.append("text").attr("y",30).attr("text-anchor","middle").text(d=>d.date.split("-")[1]+"/"+d.date.split("-")[2].slice(0,2));
}

function drawHierarchy() {
    d3.select("#hierarchy-svg").selectAll("*").remove();
    const hierarchyData = {
        name: "โครงการ DSL Platform",
        children: [
            {name:"เริ่มต้น", children: data.slice(0,4).map(d=>({name:d.title, type:d.type}))},
            {name:"พิจารณาข้อเสนอ", children: data.slice(4,6).map(d=>({name:d.title, type:d.type}))},
            {name:"ข้อพิพาท", children: data.slice(6,11).map(d=>({name:d.title, type:d.type}))},
            {name:"ยกเลิก", children: data.slice(11).map(d=>({name:d.title, type:d.type}))}
        ]
    };
    const width = 1400, height = 700;
    const svg = d3.select("#hierarchy-svg").attr("viewBox", `0 0 ${width} ${height}`);
    const g = svg.append("g").attr("transform","translate(100,50)");

    const root = d3.hierarchy(hierarchyData);
    const tree = d3.tree().size([height-100, width-300]);
    tree(root);

    g.selectAll(".link")
        .data(root.links())
        .enter().append("path")
        .attr("class","link")
        .attr("d", d3.linkHorizontal().x(d=>d.y).y(d=>d.x));

    const nodes = g.selectAll(".node")
        .data(root.descendants())
        .enter().append("g")
        .attr("class","node")
        .attr("transform", d=>`translate(${d.y},${d.x})`);

    nodes.append("circle")
        .attr("r", d=>d.children ? 20 : 15)
        .attr("fill", d=>d.data.type ? (d.data.type==="conflict"?"#dc2626":d.data.type==="meeting"?"#2563eb":d.data.type==="document"?"#16a34a":"#ca8a04") : "#666");

    nodes.append("text")
        .attr("dy",".35em")
        .attr("x", d=>d.children ? -25 : 25)
        .attr("text-anchor", d=>d.children ? "end" : "start")
        .text(d=>d.data.name.length>20 ? d.data.name.substring(0,20)+"..." : d.data.name);
}

function showTooltip(event, d) {
    tooltip.html(`
        <strong>${d.title}</strong><br>
        ${d.date.split("-")[2]+"/"+d.date.split("-")[1]+"/"+d.date.split("-")[0]}<br><br>
        ${d.desc}
    `).style("left",(event.pageX+15)+"px")
      .style("top",(event.pageY-20)+"px")
      .style("opacity",1);
}

document.querySelectorAll("[data-view]").forEach(btn => {
    btn.addEventListener("click", () => {
        document.querySelectorAll("[data-view]").forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");
        currentView = btn.dataset.view;
        document.querySelectorAll("svg").forEach(s=>s.style.display="none");
        document.getElementById(currentView+"-svg").style.display="block";
        if(currentView==="timeline") drawTimeline();
        else if(currentView==="radial") drawRadial();
        else drawHierarchy();
    });
});

document.querySelectorAll("[data-filter]").forEach(btn => {
    btn.addEventListener("click", () => {
        document.querySelectorAll("[data-filter]").forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");
        currentFilter = btn.dataset.filter;
        if(currentView==="timeline") drawTimeline();
        else if(currentView==="radial") drawRadial();
    });
});

drawTimeline();
</script>
</body>
</html>
